<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <title>火影手游 &middot; 饰品战力计算器</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <style type="text/css">
    select {
      min-width: 120px !important;
      font-size: 12px !important;
    }

    @media only screen and (min-width: 768px) {
      select {
        -webkit-appearance: none !important;
      }
    }

    input {
      font-size: 12px !important;
    }

    .input-group-addon {
      border-left-width: 0 !important;
      border-right-width: 0 !important;
    }

    .modal-body-result {
      white-space: pre-line;
    }

    .modal-body img {
      width: 160px;
    }
  </style>
</head>
<body>
  <div class="navbar navbar-default navbar-static-top">
    <div class="container">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">火影 &middot; 饰品战力计算器</a>
        <button type="button" class="btn btn-sm btn-default navbar-btn" id="button-demo">使用演示数据</button>
      </div>
    </div>
  </div>

  <div class="container">
    <form>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group text-center">第一个饰品的数据（必填）</div>
          <div class="form-group">
            <div class="input-group">
                <select name="first-alpha-attr" class="form-control">
                  <option value="none" selected>选择属性</option>
                  <option value="baoji">暴击</option>
                  <option value="baoji-washed">洗练的暴击</option>
                  <option value="kangbao">抗暴</option>
                  <option value="kangbao-washed">洗练的抗暴</option>
                  <option value="gongji">攻击</option>
                  <option value="gongji-washed">洗练的攻击</option>
                  <option value="fangyu">防御</option>
                  <option value="fangyu-washed">洗练的防御</option>
                  <option value="shengming">生命</option>
                  <option value="shengming-washed">洗练的生命</option>
                </select>
                <span class="input-group-addon">:</span>
                <input type="tel" name="first-alpha-base" value="" class="form-control" placeholder="基础数值" />
                <span class="input-group-addon hidden">+</span>
                <input type="tel" name="first-alpha-plus" value="" class="form-control hidden" placeholder="强化加成" />
            </div>
          </div>

          <div class="form-group">
            <div class="input-group">
                <select name="first-beta-attr" class="form-control">
                  <option value="none" selected>选择属性</option>
                  <option value="baoji">暴击</option>
                  <option value="baoji-washed">洗练的暴击</option>
                  <option value="kangbao">抗暴</option>
                  <option value="kangbao-washed">洗练的抗暴</option>
                  <option value="gongji">攻击</option>
                  <option value="gongji-washed">洗练的攻击</option>
                  <option value="fangyu">防御</option>
                  <option value="fangyu-washed">洗练的防御</option>
                  <option value="shengming">生命</option>
                  <option value="shengming-washed">洗练的生命</option>
                </select>
                <span class="input-group-addon">:</span>
                <input type="tel" name="first-beta-base" value="" class="form-control" placeholder="基础数值" />
                <span class="input-group-addon hidden">+</span>
                <input type="tel" name="first-beta-plus" value="" class="form-control hidden" placeholder="强化加成" />
            </div>
          </div>

          <div class="form-group">
            <div class="input-group">
                <select name="first-gamma-attr" class="form-control">
                  <option value="none" selected>选择属性</option>
                  <option value="baoji">暴击</option>
                  <option value="baoji-washed">洗练的暴击</option>
                  <option value="kangbao">抗暴</option>
                  <option value="kangbao-washed">洗练的抗暴</option>
                  <option value="gongji">攻击</option>
                  <option value="gongji-washed">洗练的攻击</option>
                  <option value="fangyu">防御</option>
                  <option value="fangyu-washed">洗练的防御</option>
                  <option value="shengming">生命</option>
                  <option value="shengming-washed">洗练的生命</option>
                </select>
                <span class="input-group-addon">:</span>
                <input type="tel" name="first-gamma-base" value="" class="form-control" placeholder="基础数值" />
                <span class="input-group-addon hidden">+</span>
                <input type="tel" name="first-gamma-plus" value="" class="form-control hidden" placeholder="强化加成" />
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group text-center">第二个饰品的数据（选填）</div>
          <div class="form-group">
            <div class="input-group">
                <select name="second-alpha-attr" class="form-control">
                  <option value="none" selected>选择属性</option>
                  <option value="baoji">暴击</option>
                  <option value="baoji-washed">洗练的暴击</option>
                  <option value="kangbao">抗暴</option>
                  <option value="kangbao-washed">洗练的抗暴</option>
                  <option value="gongji">攻击</option>
                  <option value="gongji-washed">洗练的攻击</option>
                  <option value="fangyu">防御</option>
                  <option value="fangyu-washed">洗练的防御</option>
                  <option value="shengming">生命</option>
                  <option value="shengming-washed">洗练的生命</option>
                </select>
                <span class="input-group-addon">:</span>
                <input type="tel" name="second-alpha-base" value="" class="form-control" placeholder="基础数值" />
                <span class="input-group-addon hidden">+</span>
                <input type="tel" name="second-alpha-plus" value="" class="form-control hidden" placeholder="强化加成" />
            </div>
          </div>

          <div class="form-group">
            <div class="input-group">
                <select name="second-beta-attr" class="form-control">
                  <option value="none" selected>选择属性</option>
                  <option value="baoji">暴击</option>
                  <option value="baoji-washed">洗练的暴击</option>
                  <option value="kangbao">抗暴</option>
                  <option value="kangbao-washed">洗练的抗暴</option>
                  <option value="gongji">攻击</option>
                  <option value="gongji-washed">洗练的攻击</option>
                  <option value="fangyu">防御</option>
                  <option value="fangyu-washed">洗练的防御</option>
                  <option value="shengming">生命</option>
                  <option value="shengming-washed">洗练的生命</option>
                </select>
                <span class="input-group-addon">:</span>
                <input type="tel" name="second-beta-base" value="" class="form-control" placeholder="基础数值" />
                <span class="input-group-addon hidden">+</span>
                <input type="tel" name="second-beta-plus" value="" class="form-control hidden" placeholder="强化加成" />
            </div>
          </div>

          <div class="form-group">
            <div class="input-group">
                <select name="second-gamma-attr" class="form-control">
                  <option value="none" selected>选择属性</option>
                  <option value="baoji">暴击</option>
                  <option value="baoji-washed">洗练的暴击</option>
                  <option value="kangbao">抗暴</option>
                  <option value="kangbao-washed">洗练的抗暴</option>
                  <option value="gongji">攻击</option>
                  <option value="gongji-washed">洗练的攻击</option>
                  <option value="fangyu">防御</option>
                  <option value="fangyu-washed">洗练的防御</option>
                  <option value="shengming">生命</option>
                  <option value="shengming-washed">洗练的生命</option>
                </select>
                <span class="input-group-addon">:</span>
                <input type="tel" name="second-gamma-base" value="" class="form-control" placeholder="基础数值" />
                <span class="input-group-addon hidden">+</span>
                <input type="tel" name="second-gamma-plus" value="" class="form-control hidden" placeholder="强化加成" />
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12 form-group">
          <button type="button" class="btn btn-primary btn-lg btn-block" id="button-submit" disabled>计算</button>
        </div>
      </div>

      <div class="row">
        <div class="col-xs-12">
          <button type="button" class="btn btn-default btn-block" id="button-theory">原理讲解</button>
        </div>
      </div>
    </form>
  </div>

  <div class="modal fade" id="promo-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body text-center">
          <p>暗部鼬都要下架了</p>
          <p>然而作者却没钱招募</p>
          <p>如果你觉得这个工具好用</p>
          <p>不妨扫个码</p>
          <p>赞助作者一个暗部鼬碎片</p>
          <p><img src="/images/qr-money.png" /></p>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="result-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">计算结果</h4>
        </div>
        <div class="modal-body">
          <div class="modal-body-result"></div>
          <div class="modal-body-promo text-center">
            <p>&nbsp;</p>
            <p>有用吗？扫码众筹暗部鼬送作者</p>
            <p><img src="/images/qr-money.png" /></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="theory-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">原理讲解</h4>
        </div>
        <div class="modal-body">
          <p class="text-center"><strong>饰品战力是如何计算的？</strong></p>
          <p>作者于 09-28 和 10-24 对 iOS 微信 20 区的 6 位玩家的战力和生命、攻击、防御、暴击、抗暴之间的关系进行计算，得出了一条公式，通过这条公式即可推算出每个饰品的理论战力。目前误差不超过 170。</p>
          <p>&nbsp;</p>
          <p class="text-center"><strong>什么是「保底战力」？</strong></p>
          <p>假设相同秘境的两个饰品的最差属性（或洗练属性）都可以洗成最强暴击，那么同时去掉强化加成和这两个最强暴击后，可以得到「保底战力」，这是最能真实反映两个饰品之间差距的方法。</p>
          <p>&nbsp;</p>
          <p class="text-center">有什么新想法？扫码和作者交流</p>
          <p class="text-center"><img src="/images/qr-profile.png" /></p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.bootcss.com/jquery/3.1.1/jquery.slim.min.js"></script>
  <script src="https://cdn.bootcss.com/bootstrap/3.2.0/js/modal.min.js"></script>

  <script type="text/javascript">
    $(function () {
      var SHENGMING_FACTOR = 1.0015;
      var GONGJI_FACTOR = 3.4999;
      var FANGYU_FACTOR = 11.5902;
      var BAOJI_FACTOR = 5.9982;
      var KANGBAO_FACTOR = 10.0178;

      var ATTR_FACTOR_MAP = {
        'none': 0,
        'shengming': SHENGMING_FACTOR,
        'shengming-washed': SHENGMING_FACTOR,
        'gongji': GONGJI_FACTOR,
        'gongji-washed': GONGJI_FACTOR,
        'fangyu': FANGYU_FACTOR,
        'fangyu-washed': FANGYU_FACTOR,
        'baoji': BAOJI_FACTOR,
        'baoji-washed': BAOJI_FACTOR,
        'kangbao': KANGBAO_FACTOR,
        'kangbao-washed': KANGBAO_FACTOR
      };

      var ATTR_NAME_MAP = {
        'none': '未选',
        'shengming': '生命',
        'shengming-washed': '生命',
        'gongji': '攻击',
        'gongji-washed': '攻击',
        'fangyu': '防御',
        'fangyu-washed': '防御',
        'baoji': '暴击',
        'baoji-washed': '暴击',
        'kangbao': '抗暴',
        'kangbao-washed': '抗暴'
      };

      var $buttonTheory = $('#button-theory');
      var $buttonSubmit = $('#button-submit');
      var $buttonDemo = $('#button-demo');
      var $promoModal = $('#promo-modal');
      var $theoryModal = $('#theory-modal');
      var $resultModal = $('#result-modal');
      var $resultModalBody = $('#result-modal .modal-body-result');

      var $firstAlphaAttr = $('[name=first-alpha-attr]');
      var $firstAlphaBase = $('[name=first-alpha-base]');
      var $firstAlphaPlus = $('[name=first-alpha-plus]');
      var $firstBetaAttr = $('[name=first-beta-attr]');
      var $firstBetaBase = $('[name=first-beta-base]');
      var $firstBetaPlus = $('[name=first-beta-plus]');
      var $firstGammaAttr = $('[name=first-gamma-attr]');
      var $firstGammaBase = $('[name=first-gamma-base]');
      var $firstGammaPlus = $('[name=first-gamma-plus]');
      var $secondAlphaAttr = $('[name=second-alpha-attr]');
      var $secondAlphaBase = $('[name=second-alpha-base]');
      var $secondAlphaPlus = $('[name=second-alpha-plus]');
      var $secondBetaAttr = $('[name=second-beta-attr]');
      var $secondBetaBase = $('[name=second-beta-base]');
      var $secondBetaPlus = $('[name=second-beta-plus]');
      var $secondGammaAttr = $('[name=second-gamma-attr]');
      var $secondGammaBase = $('[name=second-gamma-base]');
      var $secondGammaPlus = $('[name=second-gamma-plus]');

      function getAccessory(name, attrs) {
        var accessory = {};

        var totalPower = 0;
        var basePower = 0;
        var tempTypeStr = '';

        accessory.name = name;

        accessory.attrs = attrs.map(function (attr, index) {
          attr.name = ATTR_NAME_MAP[attr.type];
          attr.factor = ATTR_FACTOR_MAP[attr.type];
          attr.total = attr.base + attr.plus;
          attr.totalPower = attr.total * attr.factor;
          attr.basePower = attr.base * attr.factor;
          attr.additionPower = attr.plus * attr.factor;

          totalPower += attr.totalPower;
          basePower += attr.basePower;
          tempTypeStr += attr.type + '|';

          return attr;
        });

        var washedAttr = accessory.attrs.find(function (attr) {
          return attr.type.indexOf('washed') > -1;
        });

        var worstAttr = accessory.attrs.reduce(function (prev, cur) {
          return prev.basePower < cur.basePower ? prev : cur;
        });

        var washedCount = tempTypeStr.split('washed').length - 1;
        var specialPower = washedCount > 0 ? washedAttr.basePower : worstAttr.basePower;

        accessory.meta = {
          totalPower: totalPower,
          basePower: basePower,

          noneCount: tempTypeStr.split('none').length - 1,
          washedCount: washedCount,

          washedIndex: accessory.attrs.indexOf(washedAttr),
          worstIndex: accessory.attrs.indexOf(worstAttr),

          lowestPower: basePower - specialPower
        };

        return accessory;
      }

      function formatNumber(number) {
        return number.toFixed(0);
      }

      function getAttrsSentences(accessory, needLowest) {
        if (accessory.meta.totalPower === 0) {
          return [];
        }

        var sentences = [];
        sentences.push(accessory.name + '：');

        accessory.attrs.forEach(function (attr) {
          var sentence = '－' + attr.name + '战力：' + formatNumber(attr.totalPower);
          if (attr.plus) {
            sentence += '，其中基础 ' + formatNumber(attr.basePower);
          }

          sentences.push(sentence);
        });

        sentences.push('－合计战力：' + formatNumber(accessory.meta.totalPower));

        if (needLowest) {
          sentences.push('－保底战力：' + formatNumber(accessory.meta.lowestPower));
        }

        sentences.push('');
        return sentences;
      }

      $buttonDemo.on('click', function (e) {
        $firstAlphaAttr.val('baoji-washed');
        $firstAlphaBase.val('3226');
        // $firstAlphaPlus.val('2904');
        $firstBetaAttr.val('fangyu');
        $firstBetaBase.val('807');
        // $firstBetaPlus.val('727');
        $firstGammaAttr.val('fangyu');
        $firstGammaBase.val('747');
        // $firstGammaPlus.val('673');
        $secondAlphaAttr.val('baoji');
        $secondAlphaBase.val('3017');
        // $secondAlphaPlus.val('');
        $secondBetaAttr.val('baoji-washed');
        $secondBetaBase.val('3149');
        // $secondBetaPlus.val('');
        $secondGammaAttr.val('fangyu');
        $secondGammaBase.val('799');
        // $secondGammaPlus.val('');
      });

      $buttonTheory.on('click', function () {
        $theoryModal.modal();
      });

      $buttonSubmit.on('click', function () {
        var firstAccessory = getAccessory('第一个饰品', [{
          type: $firstAlphaAttr.val(),
          base: parseInt($firstAlphaBase.val(), 10) || 0,
          plus: parseInt($firstAlphaPlus.val(), 10) || 0
        }, {
          type: $firstBetaAttr.val(),
          base: parseInt($firstBetaBase.val(), 10) || 0,
          plus: parseInt($firstBetaPlus.val(), 10) || 0
        }, {
          type: $firstGammaAttr.val(),
          base: parseInt($firstGammaBase.val(), 10) || 0,
          plus: parseInt($firstGammaPlus.val(), 10) || 0
        }]);

        var secondAccessory = getAccessory('第二个饰品', [{
          type: $secondAlphaAttr.val(),
          base: parseInt($secondAlphaBase.val(), 10) || 0,
          plus: parseInt($secondAlphaPlus.val(), 10) || 0
        }, {
          type: $secondBetaAttr.val(),
          base: parseInt($secondBetaBase.val(), 10) || 0,
          plus: parseInt($secondBetaPlus.val(), 10) || 0
        }, {
          type: $secondGammaAttr.val(),
          base: parseInt($secondGammaBase.val(), 10) || 0,
          plus: parseInt($secondGammaPlus.val(), 10) || 0
        }]);

        console.log(firstAccessory);
        console.log(secondAccessory);

        if (firstAccessory.meta.noneCount === 3) {
          return alert('出错啦：第一个饰品的属性还没选择');
        }

        if (firstAccessory.meta.washedCount > 1) {
          return alert('出错啦：第一个饰品的洗练属性超过一个');
        }

        if (secondAccessory.meta.washedCount > 1) {
          return alert('出错啦：第二个饰品的洗练属性超过一个');
        }

        var sentences = [];
        var isComparing = secondAccessory.meta.totalPower > 0;

        sentences.push.apply(sentences, getAttrsSentences(firstAccessory, isComparing));
        sentences.push.apply(sentences, getAttrsSentences(secondAccessory, isComparing));

        if (isComparing) {
          var firstComparePower = firstAccessory.meta.lowestPower;
          var secondComparePower = secondAccessory.meta.lowestPower;
          var betterAccessory = firstComparePower > secondComparePower ? firstAccessory : secondAccessory;

          var accessorySelectComment = betterAccessory.name + '，保底战力领先 ' + formatNumber(Math.abs(firstComparePower - secondComparePower));

          var accessoryWashComment;
          if (betterAccessory.meta.washedCount > 0) {
            accessoryWashComment = '继续洗练，洗出最强暴击';
          } else {
            accessoryWashComment = '将' + betterAccessory.attrs[betterAccessory.meta.worstIndex].name + '（最差属性）洗成最强暴击';
          }

          sentences.push('（点「原理讲解」告诉你什么是保底战力）');
          sentences.push('');
          sentences.push('选择建议：' + accessorySelectComment);
          sentences.push('洗练建议：' + accessoryWashComment);
        }

        $resultModalBody.html(sentences.join('\n'));
        $resultModal.modal();
      });

      $buttonSubmit.prop('disabled', false);

      // $promoModal.modal();
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); // jshint ignore:line

    ga('create', 'UA-10113841-3', 'netputer.github.io');
    ga('send', 'pageview');
  </script>
</body>
</html>
